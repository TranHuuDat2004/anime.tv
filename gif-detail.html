<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Tiết GIF - ANIME.TV</title> <!-- Sẽ được cập nhật bằng JavaScript -->
    <link rel="stylesheet" href="css/style.css"> <!-- CSS CHUNG CỦA ANIME.TV -->
    <link rel="stylesheet" href="css/gif.css"> <!-- CSS CHO GIF DETAIL -->
    <link rel="stylesheet" href="css/gif-detail-custom.css"> <!-- CSS RIÊNG CHO TRANG NÀY -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="icon" href="images/favicon.png" type="image/x-icon"> <!-- Favicon của ANIME.TV -->
</head>

<body>
    <!-- NAVBAR TỪ ANIME.TV -->
    <header>
        <nav class="navbar">
            <div class="container">
                <a href="index.html" class="navbar-logo"><img src="images/logo.png" height="60"></a>
                <button class="hamburger" id="hamburger">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="navbar-menu" id="navbarMenu">
                    <ul class="navbar-nav">
                        <li><a href="index.html">Trang Chủ</a></li>
                        <li><a href="image-gallery.html">Bộ sưu tập</a></li>
                        <li><a href="gif-collection.html" class="active">Ảnh GIF</a></li>
                        <li><a href="manga.html">Manga</a></li>
                        <li><a href="game.html" >Games</a></li>
                        <li><a href="about.html">Giới thiệu</a></li>
                        <li style="padding-right: 40px;"><a href="search.html">Tìm kiếm</a></li>
                        <!-- <li style="padding-left: 40px;"><a  href="#" id="loginButton" class="login-button">Đăng Nhập</a></li> -->
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div id="featureNotification" class="notification">
        Tính năng này đang được cập nhật!
    </div>
    <!-- KẾT THÚC NAVBAR -->

    <main id="gif-detail-page">
        <div class="container" id="detailMainContainer"> <!-- Container chính -->
            <!-- Nội dung sẽ được JavaScript chèn vào đây, hoặc thông báo lỗi -->
            <p id="loadingDetailMessage"
                style="text-align:center; padding: 50px; color: var(--anime-tv-text-secondary);">Đang tải chi tiết
                GIF...</p>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-grid"> <!-- Sử dụng grid để chia cột -->
                <div class="footer-column footer-about">
                    <a href="index.html" class="footer-logo-link">
                        <img src="images/logo.png" alt="ANIME.TV Logo" class="footer-logo">
                    </a>
                    <p class="footer-tagline">ANIME.TV - Stream Your Dreams. Nơi đam mê Anime và Manga được chia sẻ và
                        khám phá.</p>
                    <p class="footer-note">Trang web được xây dựng với mục đích rèn luyện, học hỏi và không có tính
                        thương mại hóa.</p>
                </div>

                <div class="footer-column">
                    <h4>Khám Phá</h4>
                    <ul>
                        <li><a href="index.html">Trang Chủ</a></li>
                        <li><a href="manga.html">Truyện Tranh</a></li>
                        <li><a href="image-gallery.html">Ảnh Anime</a></li>
                        <li><a href="gif-collection.html">GIF Collection</a></li>
                        <li><a href="game.html">Game Xếp Hình</a></li>
                        <!-- Thêm link đến các trang "Duyệt", "Manga", "Games", "Tin tức" trên navbar nếu chúng khác với các link trên -->
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Thông Tin</h4>
                    <ul>
                        <li><a href="about.html">Về ANIME.TV</a></li>
                        <li><a href="version.html">Lịch sử phiên bản</a></li>
                        <li><a href="faq.html">Trợ giúp / FAQ</a></li>
                        <li><a href="privacy-policy.html">Điều khoản sử dụng</a></li>
                        <li><a href="terms-of-service.html">Chính sách riêng tư</a></li>
                        <!-- Thêm link "Liên hệ" nếu có -->
                    </ul>
                </div>

                <div class="footer-column footer-social"> <!-- (Tùy chọn) Cho mạng xã hội hoặc thông tin thêm -->
                    <h4>Kết Nối</h4>
                    <div class="social-icons">
                        <a href="#" title="Facebook" target="_blank" rel="noopener noreferrer">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#F28C38"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M22.675 0H1.325C.593 0 0 .593 0 1.325v21.351C0 23.407.593 24 1.325 24H12.82v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116c.73 0 1.323-.593 1.323-1.325V1.325C24 .593 23.407 0 22.675 0z" />
                            </svg>
                        </a>
                        <a href="#" title="Twitter" target="_blank" rel="noopener noreferrer">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#F28C38"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                            </svg>
                        </a>
                        <a href="https://github.com/TranHuuDat2004/" title="GitHub" target="_blank" rel="noopener noreferrer">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#F28C38"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M12 0C5.373 0 0 5.373 0 12c0 5.303 3.438 9.8 8.205 11.387.6.11.82-.26.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.729.083-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.834 2.809 1.304 3.495.997.108-.775.418-1.305.762-1.605-2.665-.305-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.435.375.81 1.11.81 2.235 0 1.615-.015 2.91-.015 3.3 0 .315.21.69.825.57C20.565 21.8 24 17.303 24 12c0-6.627-5.373-12-12-12z" />
                            </svg>
                        </a>

                        <a href="#" title="LinkedIn" target="_blank" rel="noopener noreferrer">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#F28C38"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M22.23 0H1.77C.79 0 0 .774 0 1.729v20.542C0 23.226.79 24 1.77 24h20.46c.98 0 1.77-.774 1.77-1.729V1.729C24 .774 23.21 0 22.23 0zM7.12 20.452H3.558V9.043h3.562v11.409zM5.34 7.757c-1.14 0-2.062-.928-2.062-2.064 0-1.135.923-2.062 2.062-2.062 1.135 0 2.062.927 2.062 2.062 0 1.136-.927 2.064-2.062 2.064zm15.112 12.695h-3.558v-5.57c0-1.328-.027-3.037-1.852-3.037-1.852 0-2.136 1.446-2.136 2.94v5.667H9.34V9.043h3.414v1.55h.048c.476-.898 1.638-1.846 3.37-1.846 3.605 0 4.27 2.373 4.27 5.46v6.245z" />
                            </svg>
                        </a>

                    </div>
                    <p class="mt-3">Email liên hệ: <a
                            href="mailto:huudat2004.anime@gmail.com">huudat2004.anime@gmail.com</a></p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>© <span id="footerCurrentYear">2025</span> ANIME.TV. Dựa trên ý tưởng từ Crunchyroll. Phát triển bởi
                    Trần Hữu Đạt.</p>
            </div>
        </div>
    </footer>
    <script src="js/navbar.js"></script> <!-- Script cho navbar (hamburger menu) -->

    <div id="featureNotification" class="notification">
        Tính năng này đang được cập nhật!
    </div>

    <!-- ĐẢM BẢO ĐƯỜNG DẪN ĐÚNG -->
    <script src="js/data-gif.js"></script> <!-- Hoặc data.js nếu bạn dùng chung -->
    <script src="js/notification.js"></script> <!-- Nếu bạn tách ra file riêng -->
    <script>
        // JavaScript cho detail-gif.html (đã sửa)
        document.addEventListener('DOMContentLoaded', () => {
            const detailMainContainer = document.getElementById('detailMainContainer');
            const loadingDetailMessage = document.getElementById('loadingDetailMessage'); // ID đã sửa

            const params = new URLSearchParams(window.location.search);
            const gifId = params.get('id');

            function showError(message) {
                if (loadingDetailMessage) loadingDetailMessage.remove();
                detailMainContainer.innerHTML = `<p class="error-message" style="text-align:center; padding: 50px;">${message}</p>`;
            }

            if (!gifId) {
                showError('Lỗi: Không tìm thấy ID của GIF trong URL.');
                return;
            }

            // Đảm bảo animeGifData (hoặc tên biến dữ liệu GIF của bạn) đã được tải
            if (typeof animeGifData === 'undefined' || Object.keys(animeGifData).length === 0) {
                console.error("Lỗi: animeGifData không được định nghĩa hoặc rỗng.");
                showError('Lỗi tải dữ liệu GIF.');
                return;
            }

            let foundGif = null;
            let seriesName = '';
            let seriesKeyForFoundGif = '';
            let fullUrl = '';

            for (const seriesKey in animeGifData) {
                const series = animeGifData[seriesKey];
                // So sánh ID dạng chuỗi
                const gif = series.gifs.find(g => String(g.id) === String(gifId));
                if (gif) {
                    foundGif = gif;
                    seriesName = series.displayName;
                    seriesKeyForFoundGif = seriesKey;
                    fullUrl = series.isExternal ? gif.url : (series.folder + gif.fileName);
                    break;
                }
            }

            if (loadingDetailMessage) loadingDetailMessage.remove();

            if (foundGif) {
                document.title = `${foundGif.title || 'Chi Tiết GIF'} - ANIME.TV`;

                // Tạo cấu trúc HTML mới cho chi tiết GIF
                const gifDetailHTML = `
                    <div class="gif-detail-container">
                        <div class="gif-image-wrapper">
                            <img id="gifDetailImage" src="${fullUrl}" alt="${foundGif.title || 'Ảnh GIF'}">
                        </div>
                        <div class="gif-info-wrapper">
                            <h1 id="gifDetailTitle">${foundGif.title || 'Không có tiêu đề'}</h1>
                            <p class="gif-detail-series"><strong>Series:</strong> <span id="gifDetailSeriesName">${seriesName || 'Không rõ'}</span></p>
                            <div class="gif-detail-tags">
                                <strong>Tags:</strong>
                                <div id="gifDetailTagsContainer">
                                    ${foundGif.tags && foundGif.tags.length > 0
                        ? foundGif.tags.map(tag => `<span class="tag-item-detail">${tag}</span>`).join('')
                        : '<span style="color: var(--anime-tv-text-secondary);">Không có tags</span>'
                    }
                                </div>
                            </div>
                            <a href="${fullUrl}" id="downloadGifButton" class="btn btn-primary btn-download" download>
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                Tải Xuống GIF
                            </a>
                        </div>
                    </div>

                    <section class="related-gifs-section" style="margin-top: 40px;">
                        <h2>GIF Khác Từ Series Này</h2>
                        <div id="relatedGifsGrid" class="gif-gallery view-small">
                            <!-- GIF liên quan -->
                        </div>
                    </section>
                `;
                detailMainContainer.innerHTML = gifDetailHTML; // Chèn HTML vào container chính

                // Thiết lập tên file download sau khi HTML được chèn
                const downloadButton = document.getElementById('downloadGifButton');
                if (downloadButton) {
                    let downloadFileName;
                    const currentSeriesInfo = animeGifData[seriesKeyForFoundGif];
                    const isExternal = currentSeriesInfo ? currentSeriesInfo.isExternal : (foundGif.url && !foundGif.fileName);

                    if (!isExternal && foundGif.fileName) {
                        downloadFileName = foundGif.fileName;
                    } else if (foundGif.url) {
                        const cleanTitle = (foundGif.title || 'gif').replace(/[^a-z0-9\s]/gi, '').replace(/\s+/g, '_').toLowerCase();
                        let baseName = `${foundGif.id}_${cleanTitle}`;
                        let extension = '.gif';
                        try {
                            const urlPath = new URL(foundGif.url).pathname;
                            const lastSegment = urlPath.substring(urlPath.lastIndexOf('/') + 1);
                            if (lastSegment.includes('.')) {
                                const detectedExtension = lastSegment.substring(lastSegment.lastIndexOf('.'));
                                if (['.gif', '.webp', '.png', '.jpg', '.jpeg', '.mp4'].includes(detectedExtension.toLowerCase())) {
                                    extension = detectedExtension.toLowerCase();
                                }
                            }
                        } catch (e) { console.warn("Could not parse URL to detect extension:", foundGif.url); }
                        downloadFileName = baseName + extension;
                    } else {
                        downloadFileName = `${foundGif.id}_download.gif`;
                    }
                    downloadButton.setAttribute('download', downloadFileName);
                }

                // Trong detail-gif.html, bên trong hàm DOMContentLoaded, sau khi đã tìm thấy targetGif

                // ... (code hiển thị chi tiết GIF chính và nút download) ...

                // Hiển thị GIF liên quan (Đã cập nhật)
                const relatedGifsGridElement = document.getElementById('relatedGifsGrid');
                const relatedGifsSection = document.querySelector('.related-gifs-section');

                if (seriesKeyForFoundGif && animeGifData[seriesKeyForFoundGif] && relatedGifsGridElement && relatedGifsSection) {
                    relatedGifsGridElement.innerHTML = ''; // Xóa kết quả cũ
                    const seriesData = animeGifData[seriesKeyForFoundGif];

                    // Lọc ra tất cả GIF khác trong cùng series
                    let otherGifsInSeries = seriesData.gifs.filter(g => String(g.id) !== String(gifId));

                    // Xáo trộn mảng otherGifsInSeries
                    function shuffleArray(array) {
                        for (let i = array.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [array[i], array[j]] = [array[j], array[i]];
                        }
                    }
                    shuffleArray(otherGifsInSeries);

                    // Lấy tối đa 20 GIF đã xáo trộn
                    const relatedGifs = otherGifsInSeries.slice(0, 20);

                    if (relatedGifs.length > 0) {
                        relatedGifsSection.style.display = 'block'; // Hiện section

                        relatedGifs.forEach(relatedGif => {
                            const gifItemLink = document.createElement('a'); // Dùng thẻ <a> để click được
                            gifItemLink.href = `gif-detail.html?id=${relatedGif.id}`;
                            gifItemLink.classList.add('gif-item'); // Tái sử dụng class từ gif-collection

                            // Thêm wrapper cho ảnh và tiêu đề (nếu muốn hiển thị tiêu đề nhỏ bên dưới)
                            const gifItemContent = document.createElement('div');
                            // gifItemContent.classList.add('related-gif-content'); // Class riêng nếu cần style khác

                            const img = document.createElement('img');
                            img.src = seriesData.isExternal ? relatedGif.url : (seriesData.folder + relatedGif.fileName);
                            img.alt = relatedGif.title || 'Related GIF';
                            img.loading = 'lazy';
                            // Không cần đặt width/height ở đây nếu CSS đã xử lý aspect-ratio

                            gifItemContent.appendChild(img);

                            // (Tùy chọn) Hiển thị tiêu đề nhỏ cho GIF liên quan
                            // const titleP = document.createElement('p');
                            // titleP.classList.add('related-gif-title');
                            // titleP.textContent = relatedGif.title || 'GIF';
                            // gifItemContent.appendChild(titleP);

                            gifItemLink.appendChild(gifItemContent);
                            relatedGifsGridElement.appendChild(gifItemLink);
                        });
                    } else {
                        relatedGifsSection.style.display = 'none'; // Ẩn section nếu không có GIF liên quan
                    }
                } else if (relatedGifsSection) { // Ẩn nếu không có series key hoặc data
                    relatedGifsSection.style.display = 'none';
                }



            } else { // Không tìm thấy GIF
                showError(`Không tìm thấy GIF với ID: ${gifId}`);
            }
        });
    </script>


</body>

</html>